# 설문조사 응답 분석 가이드

## 📋 목차
1. [개요](#개요)
2. [워크플로우](#워크플로우)
3. [설문조사 응답 분석 실행](#설문조사-응답-분석-실행)
4. [리포트 확인](#리포트-확인)
5. [문제 해결](#문제-해결)

---

## 📖 개요

설문조사 시스템은 2단계로 운영됩니다:

### **1단계: 설문조사 생성 및 발송**
```powershell
python src/advanced_restaurant_system.py
```
- 맛집 추천
- Google Forms 생성
- 이메일 발송

### **2단계: 응답 수집 및 분석** ⭐ 이 문서의 내용
```powershell
python src/survey_data_analyzer.py
```
- 응답 수집 확인
- AI 데이터 분석
- 리포트 생성 및 이메일 발송

---

## 🔄 워크플로우

```
┌─────────────────────────────────────────┐
│ 1. 맛집 추천 및 설문조사 생성           │
│    python src/advanced_restaurant_system.py │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│ 2. 설문조사 링크 이메일 발송            │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│ 3. 사용자들이 응답 제출                 │
│    (실시간으로 Google Forms에 수집)     │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│ 4. 응답 분석 및 리포트 생성 ⭐          │
│    python src/survey_data_analyzer.py   │
│                                         │
│    ✅ 현재까지 응답 수 확인              │
│    ✅ AI 분석 실행                      │
│    ✅ 리포트 생성 (Markdown)            │
│    ✅ 이메일 발송 (선택)                │
└─────────────────────────────────────────┘
```

---

## 🚀 설문조사 응답 분석 실행

### 준비사항

1. **Google Form ID 확인**
   - 설문조사 생성 시 출력된 링크에서 확인
   - 예: `https://docs.google.com/forms/d/ABC123XYZ/viewform`
   - Form ID: `ABC123XYZ` (← 이 부분을 복사)

2. **OAuth 2.0 인증 확인**
   - `config/token.json` 파일이 존재해야 함
   - 없다면 `test_google_forms_oauth.py` 실행

---

### 실행 방법

#### Step 1: 분석 스크립트 실행

```powershell
python src/survey_data_analyzer.py
```

#### Step 2: Form ID 입력

```
================================================================================
📊 설문조사 데이터 분석 시스템
================================================================================

📋 Google Form ID를 입력하세요:
   (Form URL에서 '/d/' 다음의 문자열)
   예시: https://docs.google.com/forms/d/[FORM_ID]/viewform

Form ID: ABC123XYZ  ← 여기에 입력
```

#### Step 3: 응답 수 확인

```
================================================================================
📥 설문조사 응답 가져오는 중...
================================================================================

✅ 응답 수집 완료!
   📊 현재까지 설문조사 완료된 개수: 15개
```

**응답이 0개인 경우:**
```
⚠️  아직 응답이 없습니다.
   설문조사 링크를 공유하고 응답을 받은 후 다시 실행하세요.
```

#### Step 4: 리포트 작성 확인

```
================================================================================
📝 현재까지 결과로 리포트를 작성하시겠습니까?
   현재 응답 수: 15개
================================================================================

리포트 작성 (y/n): y  ← 'y' 입력
```

**취소하려면:** `n` 입력

#### Step 5: AI 분석 실행

```
================================================================================
🤖 AI 데이터 분석 시작...
================================================================================

(AI 에이전트가 설문조사 응답을 분석합니다...)

✅ 데이터 분석 완료!
```

#### Step 6: 리포트 생성

```
================================================================================
📄 리포트 생성 중...
================================================================================

✅ 리포트 생성 완료!
   📁 저장 위치: C:\work\workspace_crewai_test\reports\survey_report_20251001_120000.md
```

#### Step 7: 이메일 발송 (선택)

```
================================================================================
📧 리포트를 이메일로 발송하시겠습니까?
================================================================================

이메일 발송 (y/n): y  ← 'y' 입력

📧 이메일 발송 중... (수신자: 2명)

✅ 이메일 발송 완료!
```

**이메일 발송 안함:** `n` 입력

---

## 📊 리포트 확인

### 리포트 파일 위치

```
reports/survey_report_YYYYMMDD_HHMMSS.md
```

### 리포트 내용 구조

```markdown
# 설문조사 분석 리포트

## 📋 기본 정보
- 설문조사 제목: 맛집 추천 만족도 설문조사
- 분석 일시: 2025년 10월 01일 12:00:00
- 총 응답 수: 15개

---

## 📊 응답 현황

### 맛집 선호도

- **[1위] 맛있는 식당**: 8표 (53.3%)
- **[2위] 훌륭한 음식점**: 5표 (33.3%)
- **[3위] 좋은 레스토랑**: 2표 (13.3%)

### 💬 사용자 피드백

1. "추천이 정확해서 좋았습니다"
2. "가격대가 적절했어요"
3. "더 다양한 옵션이 있으면 좋겠습니다"
...

---

## 🤖 AI 분석 결과

(AI 에이전트가 생성한 상세 분석 내용)

- 전반적인 만족도
- 개선 제안사항
- 추천 트렌드 분석
...
```

### 리포트 열기

```powershell
# Markdown 파일 열기
code reports/survey_report_20251001_120000.md

# 또는 기본 텍스트 에디터로 열기
notepad reports/survey_report_20251001_120000.md
```

---

## 🔧 문제 해결

### ❌ 오류 1: "Google Forms API 인증 실패"

**원인:**
- `token.json` 파일이 없거나 만료됨

**해결:**
```powershell
python test_google_forms_oauth.py
```

Google 로그인 후 재시도

---

### ❌ 오류 2: "Form을 찾을 수 없습니다"

**원인:**
- 잘못된 Form ID 입력
- Form이 삭제되었거나 권한이 없음

**해결:**
1. Form ID 재확인
2. Google Forms에서 해당 설문조사가 존재하는지 확인
3. 본인이 생성한 Form인지 확인

---

### ❌ 오류 3: "응답을 읽을 권한이 없습니다"

**원인:**
- OAuth 스코프에 응답 읽기 권한이 없음

**해결:**
1. `config/token.json` 삭제
2. `test_google_forms_oauth.py` 재실행
3. 권한 승인 시 "응답 읽기" 권한 확인

---

### ❌ 오류 4: "수신자가 설정되지 않았습니다"

**원인:**
- `config.json`의 `email_settings.recipients`가 비어있음

**해결:**
```json
{
  "email_settings": {
    "recipients": [
      "user1@example.com",
      "user2@example.com"
    ]
  }
}
```

---

## 💡 사용 팁

### 1. 응답 수집 모니터링

주기적으로 스크립트를 실행하여 응답 수를 확인:

```powershell
# 현재 응답 수만 확인하고 종료 (리포트 작성 'n')
python src/survey_data_analyzer.py
```

### 2. 여러 번 분석 가능

- 같은 Form ID로 여러 번 실행 가능
- 매번 새로운 리포트 파일 생성 (`타임스탬프_포함`)
- 응답 추이 비교 가능

### 3. 리포트 백업

```powershell
# reports 폴더 전체 백업
Copy-Item -Recurse reports reports_backup_YYYYMMDD
```

### 4. 이메일 발송 설정

리포트를 자동으로 특정 인원에게만 발송:

```json
{
  "email_settings": {
    "recipients": [
      "manager@company.com",     ← 팀장
      "analyst@company.com"      ← 분석가
    ]
  }
}
```

---

## 📈 분석 주기 권장사항

| 응답 수 | 분석 주기 | 목적 |
|---------|-----------|------|
| 0-5개 | 매일 확인 | 초기 응답 모니터링 |
| 5-20개 | 2-3일마다 | 중간 분석 |
| 20개 이상 | 최종 분석 | 종합 리포트 작성 |

---

## 🔗 관련 문서

- **설문조사 생성:** `docs/guides/REAL_EMAIL_SURVEY_GUIDE.md`
- **OAuth 2.0 설정:** `docs/guides/OAUTH_TROUBLESHOOTING.md`
- **이메일 설정:** `docs/guides/GMAIL_SMTP_SETUP.md`

---

## 📝 체크리스트

분석 실행 전 확인사항:

- [ ] Google Form ID 확인
- [ ] token.json 존재 확인
- [ ] 설문조사 응답이 1개 이상
- [ ] config.json 이메일 설정 (리포트 발송 시)
- [ ] reports 폴더 쓰기 권한

**모두 체크되었다면 분석 준비 완료!** ✅

---

## 🎯 빠른 시작 (치트시트)

```powershell
# 1. 설문조사 생성 및 발송
python src/advanced_restaurant_system.py

# 2. 응답 대기...

# 3. 응답 분석 및 리포트
python src/survey_data_analyzer.py

# 4. 리포트 확인
code reports/survey_report_*.md
```

**완료!** 🎉

